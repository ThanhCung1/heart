<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Valentine üíù</title>

<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600&display=swap" rel="stylesheet">

<style>
body{margin:0;background:black;overflow:hidden}

#imgView{position:fixed;inset:0;background:rgba(0,0,0,.9);display:none;z-index:5}
#imgView img{
 position:absolute;top:50%;left:50%;
 transform:translate(-50%,-50%);
 max-width:90vw;max-height:90vh;
 border-radius:20px;
 box-shadow:0 0 40px white;
}

#letter{position:fixed;inset:0;background:rgba(0,0,0,.92);display:none;z-index:6}
#letterBox{
 max-width:650px;margin:60px auto;
 background:white;color:#d6336c;
 padding:35px;border-radius:25px;
 line-height:1.7;font-size:26px;
 font-family:'Dancing Script', cursive;
 box-shadow:0 0 50px #ff6699;
}

#lockScreen{
 position:fixed;inset:0;background:black;color:white;
 display:flex;flex-direction:column;
 align-items:center;justify-content:center;
 z-index:10;gap:15px;font-size:24px;text-align:center;
}

input,button{
 padding:12px 18px;font-size:20px;
 border-radius:12px;border:none;
}
button{background:#ff4d88;color:white;cursor:pointer}
</style>
</head>

<body>

<canvas id="c"></canvas>

<div id="imgView"><img id="bigImg"></div>

<div id="letter">
  <div id="letterBox"></div>
</div>

<div id="lockScreen">
üíùType the password to open the heart.üíù
<input id="pwInput" type="password">
<button onclick="unlock()">M·ªü kh√≥a</button>
<div id="pwMsg"></div>
</div>

<audio id="bgm" src="Music.mp3" loop></audio>

<script>
const PASSWORD="27122024";

const c=document.getElementById("c");
const ctx=c.getContext("2d");
function resize(){c.width=innerWidth;c.height=innerHeight}
resize();onresize=resize;
//////////////// TYPEWRITER TEXT
const letterText = `
üíå G·ª≠i em ,

ƒê√¢y l√† Valentine ƒë·∫ßu ti√™n c·ªßa ch√∫ng ta ‚ù§Ô∏èv√† anh tin ƒë√≥ s·∫Ω ch·ªâ l√† kh·ªüi ƒë·∫ßu cho r·∫•t nhi·ªÅu m√πa y√™u th∆∞∆°ng ph√≠a tr∆∞·ªõc.
C·∫£m ∆°n em ƒë√£ b∆∞·ªõc v√†o cu·ªôc s·ªëng c·ªßa anh m·ªôt c√°ch nh·∫π nh√†ng nh∆∞ng l·∫°i l√†m m·ªçi th·ª© tr·ªü n√™n ·∫•m √°p h∆°n r·∫•t nhi·ªÅu.
Anh hy v·ªçng m√¨nh c·ª© y√™u nh∆∞ v·∫≠y ‚ù§Ô∏èquan t√¢m nhau m·ªôt ch√∫t, nh∆∞·ªùng nhau m·ªôt ch√∫t, hi·ªÉu nhau nhi·ªÅu h∆°n m·ªôt ch√∫t.
Y√™u em ‚ù§Ô∏è
     Happy Valentine üíù
    ‚Äî Th√†nh Cung ‚Äî
`;
let typingTimer = null;
let typingDone = false;

function typeWriter(text, element, speed=40){

 if(typingTimer) clearInterval(typingTimer); // d·ª´ng l·∫ßn g√µ tr∆∞·ªõc

 element.innerHTML="";
 typingDone = false;

 let i=0;

 typingTimer = setInterval(()=>{

   element.innerHTML += text[i] === "\n" ? "<br>" : text[i];
   i++;

   if(i>=text.length){
     clearInterval(typingTimer);
     typingTimer = null;
     typingDone = true;
   }

 }, speed);
}

//////////////// LOAD IMAGES
const imgs=[];
for(let i=1;i<=6;i++){
 let im=new Image();
 im.src="images/"+i+".jpg";
 imgs.push(im);
}

//////////////// HEART PATH
function heartPath(x,y,s){
 ctx.beginPath();
 for(let i=0;i<=100;i++){
  let t=i/100*Math.PI*2;
  let px=16*Math.sin(t)**3;
  let py=13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t);
  px=x+px*s; py=y-py*s;
  i?ctx.lineTo(px,py):ctx.moveTo(px,py);
 }
 ctx.closePath();
}

//////////////// BIG HEART
let bigGlow=60;
const bigHeart={x:()=>c.width/2,y:()=>c.height/2,s:14};

function drawBigHeart(){
 let x=bigHeart.x(), y=bigHeart.y();
 ctx.save();
 heartPath(x,y,bigHeart.s);
 ctx.fillStyle="white";
 ctx.shadowBlur=bigGlow;
 ctx.shadowColor="#ff6699";
 ctx.fill();
 ctx.restore();
 ctx.font="60px serif";
 ctx.textAlign="center";
 ctx.fillText("‚úâÔ∏è",x,y+18);
}

//////////////// SMALL HEART IMAGE
class SmallHeart{
 constructor(){this.reset();}
 reset(){
  this.x=Math.random()*c.width;
  this.y=c.height+40;
  this.v=1+Math.random()*2;
  this.s=2+Math.random()*2;
  this.img=imgs[Math.floor(Math.random()*imgs.length)];
 }
 update(){this.y-=this.v;if(this.y<-40)this.reset();}
 draw(){
  ctx.save();
  heartPath(this.x,this.y,this.s);
  ctx.fillStyle="#ff4d6d";
  ctx.shadowBlur=18;
  ctx.shadowColor="#ff99aa";
  ctx.fill();
  ctx.restore();

  if(this.img.complete){
   ctx.save();
   heartPath(this.x,this.y,this.s*0.75);
   ctx.clip();
   ctx.drawImage(this.img,this.x-18,this.y-18,36,36);
   ctx.restore();
  }
 }
 hit(mx,my){return Math.hypot(mx-this.x,my-this.y)<22;}
}

const smalls=[];
for(let i=0;i<70;i++) smalls.push(new SmallHeart());

//////////////// SPARKLES
const sparks=[];
for(let i=0;i<120;i++){
 sparks.push({x:Math.random()*c.width,y:Math.random()*c.height,a:Math.random()});
}
function drawSparkles(){
 sparks.forEach(s=>{
  s.a+=0.03;
  ctx.globalAlpha=(Math.sin(s.a)+1)/2;
  ctx.fillStyle="white";
  ctx.fillRect(s.x,s.y,2,2);
 });
 ctx.globalAlpha=1;
}

//////////////// CLICK
c.onclick=e=>{
 let r=c.getBoundingClientRect();
 let mx=e.clientX-r.left;
 let my=e.clientY-r.top;

 for(let h of smalls){
  if(h.hit(mx,my)){
   bigImg.src=h.img.src;
   imgView.style.display="block";
   return;
  }
 }

if(Math.hypot(mx-bigHeart.x(),my-bigHeart.y())<180){
if(letter.style.display === "block") return;

letter.style.display="block";
typeWriter(letterText, letterBox, 45);

}

};

imgView.onclick=()=>imgView.style.display="none";
letter.onclick=()=>letter.style.display="none";

//////////////// UNLOCK + PLAY MUSIC
function unlock(){
 if(pwInput.value===PASSWORD){

  lockScreen.style.display="none";

  // ph√°t nh·∫°c khi m·ªü kh√≥a
  bgm.pause();
  bgm.currentTime=0;
  bgm.play().catch(()=>{});

  // ch·ªâ l√†m tim s√°ng l√™n ‚Äî KH√îNG m·ªü th∆∞
  flash();

 }else{
  pwMsg.innerHTML="‚ùå Sai m·∫≠t kh·∫©u";
  pwInput.value="";
 }
}

function flash(){
 let g=60;
 let t=setInterval(()=>{
  g+=5; bigGlow=g;
  if(g>120) clearInterval(t);
 },30);
}

//////////////// LOOP
function loop(){
 ctx.clearRect(0,0,c.width,c.height);
 drawSparkles();
 drawBigHeart();
 smalls.forEach(h=>{h.update();h.draw();});
 requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
